tinymce.PluginManager.add('document', function(editor, url) {
  // Add a button that opens a window
  editor.addButton('document', {
    text: 'Insert document',
    icon: false,
    onclick: function() {
      $.ajax({
        url: Keystone.adminPath + '/api/files?basic&search=&limit=1000'
      }).done(function(data) {
        var docs = data.results.map(function(doc, index) {
          var item = {
            value: index,
            text: doc.name,
            url: doc.fields.fileUrl
          };
          return item;
        });
        // Open window
        editor.windowManager.open({
          title: 'Please select file to insert as a link',
          body: [
            {type: 'listbox', values: docs, name: 'document', label: 'Document'}
          ],
          onsubmit: function(e) {
            console.log(docs, e.data.document)
            editor.insertContent('<a href="' + docs[e.data.document].url + '">' + docs[e.data.document].text + '</a>');
          }
        });
      })
    }
  });

  return {
    getMetadata: function () {
      return  {
        name: "Document plugin"
      };
    }
  };
});
